import { TelegramService } from './services/TelegramService.js';
import { Calendar } from './components/Calendar.js';
import { DatePicker } from './components/DatePicker.js';
import { Settings } from './components/Settings.js';
import { Footer } from './components/Footer.js';

class App {
    constructor() {
        this.telegram = new TelegramService();
        this.components = {
            calendar: new Calendar('#lifeCanvas'),
            datePicker: new DatePicker('#birthdate-input'),
            settings: new Settings('#settingsForm'),
            footer: new Footer('.footer')
        };
        
        this.init();
        this.setupEventListeners();
    }

    init() {
        this.telegram.init();
        Object.values(this.components).forEach(component => component.init());
        
        if (!this.telegram.isTelegramWebApp()) {
            this.components.settings.showBrowserNotice();
            // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÐºÐ»Ð°ÑÑ Ðº body Ð´Ð»Ñ ÑÑ‚Ð¸Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸
            document.body.classList.add('browser-mode');
            console.log('ðŸŒ ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¾ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ');
        } else {
            document.body.classList.add('webapp-mode');
            console.log('ðŸ“± ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¾ Ð² Telegram WebApp');
        }
    }

    setupEventListeners() {
        // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð´Ð»Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÐºÐ°Ð»ÐµÐ½Ð´Ð°Ñ€Ñ
        document.getElementById('create-calendar-btn')?.addEventListener('click', () => {
            this.components.settings.handleFormSubmit();
        });

        // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð´Ð»Ñ ÑÑÑ‹Ð»ÐºÐ¸ Ð°Ð²Ñ‚Ð¾Ñ€Ð°
        document.getElementById('author-link')?.addEventListener('click', () => {
            this.components.footer.toggleHiddenContent();
        });
    }
}

// Ð¡Ð´ÐµÐ»Ð°ÐµÐ¼ ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ð¼
let app;

// Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð¿Ð¾ÑÐ»Ðµ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ DOM
document.addEventListener('DOMContentLoaded', () => {
    // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
    app = new App();
    window.app = app; // Ð”Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ð¸Ð· ÐºÐ¾Ð½ÑÐ¾Ð»Ð¸
    
    // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð´Ð»Ñ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚Ð¸
    window.changeLanguage = (lang) => app.components.settings.handleLanguageChange(lang);
    window.changeTheme = (theme) => app.components.settings.handleThemeChange(theme);
});
